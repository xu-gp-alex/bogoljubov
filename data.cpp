#include "data.hpp"

u8 pieces[64];
const Piece init[64] = {
    R, N, B, Q, K, B, N, R,
    P, P, P, P, P, P, P, P, 
    X, X, X, X, X, X, X, X, 
    X, X, X, X, X, X, X, X, 
    X, X, X, X, X, X, X, X, 
    X, X, X, X, X, X, X, X, 
    P, P, P, P, P, P, P, P, 
    R, N, B, Q, K, B, N, R
};
const Piece test[64] = {
    R, N, B, Q, K, B, N, R,
    P, P, P, P, P, P, P, P, 
    X, X, X, X, X, X, X, X, 
    X, X, X, X, X, X, X, X, 
    X, X, X, X, X, X, X, X, 
    X, X, X, X, X, X, X, X, 
    P, P, P, P, P, P, P, P, 
    R, N, B, Q, K, B, N, R
};

u32 ply;
Side side;
i32 en_peasant;

bool can_white_k_castle;
bool can_white_q_castle;
bool can_black_k_castle;
bool can_black_q_castle;

const u64 rook_masks[64] = {
    0x101010101017eull, 
    0x202020202027cull, 
    0x404040404047aull, 
    0x8080808080876ull, 
    0x1010101010106eull, 
    0x2020202020205eull, 
    0x4040404040403eull, 
    0x8080808080807eull, 
    0x1010101017e00ull, 
    0x2020202027c00ull, 
    0x4040404047a00ull, 
    0x8080808087600ull, 
    0x10101010106e00ull, 
    0x20202020205e00ull, 
    0x40404040403e00ull, 
    0x80808080807e00ull, 
    0x10101017e0100ull, 
    0x20202027c0200ull, 
    0x40404047a0400ull, 
    0x8080808760800ull, 
    0x101010106e1000ull, 
    0x202020205e2000ull, 
    0x404040403e4000ull, 
    0x808080807e8000ull, 
    0x101017e010100ull, 
    0x202027c020200ull, 
    0x404047a040400ull, 
    0x8080876080800ull, 
    0x1010106e101000ull, 
    0x2020205e202000ull, 
    0x4040403e404000ull, 
    0x8080807e808000ull, 
    0x1017e01010100ull, 
    0x2027c02020200ull, 
    0x4047a04040400ull, 
    0x8087608080800ull, 
    0x10106e10101000ull, 
    0x20205e20202000ull, 
    0x40403e40404000ull, 
    0x80807e80808000ull, 
    0x17e0101010100ull, 
    0x27c0202020200ull, 
    0x47a0404040400ull, 
    0x8760808080800ull, 
    0x106e1010101000ull, 
    0x205e2020202000ull, 
    0x403e4040404000ull, 
    0x807e8080808000ull, 
    0x7e010101010100ull, 
    0x7c020202020200ull, 
    0x7a040404040400ull, 
    0x76080808080800ull, 
    0x6e101010101000ull, 
    0x5e202020202000ull, 
    0x3e404040404000ull, 
    0x7e808080808000ull, 
    0x7e01010101010100ull, 
    0x7c02020202020200ull, 
    0x7a04040404040400ull, 
    0x7608080808080800ull, 
    0x6e10101010101000ull, 
    0x5e20202020202000ull, 
    0x3e40404040404000ull, 
    0x7e80808080808000ull,
};
const u64 bishop_masks[64] = {
    0x40201008040200ull, 
    0x402010080400ull, 
    0x4020100a00ull, 
    0x40221400ull, 
    0x2442800ull, 
    0x204085000ull, 
    0x20408102000ull, 
    0x2040810204000ull, 
    0x20100804020000ull, 
    0x40201008040000ull, 
    0x4020100a0000ull, 
    0x4022140000ull, 
    0x244280000ull, 
    0x20408500000ull, 
    0x2040810200000ull, 
    0x4081020400000ull, 
    0x10080402000200ull, 
    0x20100804000400ull, 
    0x4020100a000a00ull, 
    0x402214001400ull, 
    0x24428002800ull, 
    0x2040850005000ull, 
    0x4081020002000ull, 
    0x8102040004000ull, 
    0x8040200020400ull, 
    0x10080400040800ull, 
    0x20100a000a1000ull, 
    0x40221400142200ull, 
    0x2442800284400ull, 
    0x4085000500800ull, 
    0x8102000201000ull, 
    0x10204000402000ull, 
    0x4020002040800ull, 
    0x8040004081000ull, 
    0x100a000a102000ull, 
    0x22140014224000ull, 
    0x44280028440200ull, 
    0x8500050080400ull, 
    0x10200020100800ull, 
    0x20400040201000ull, 
    0x2000204081000ull, 
    0x4000408102000ull, 
    0xa000a10204000ull, 
    0x14001422400000ull, 
    0x28002844020000ull, 
    0x50005008040200ull, 
    0x20002010080400ull, 
    0x40004020100800ull, 
    0x20408102000ull, 
    0x40810204000ull, 
    0xa1020400000ull, 
    0x142240000000ull, 
    0x284402000000ull, 
    0x500804020000ull, 
    0x201008040200ull, 
    0x402010080400ull, 
    0x2040810204000ull, 
    0x4081020400000ull, 
    0xa102040000000ull, 
    0x14224000000000ull, 
    0x28440200000000ull, 
    0x50080402000000ull, 
    0x20100804020000ull, 
    0x40201008040200ull
};
const u64 knight_masks[64] = {
    0x20400ull, 
    0x50800ull, 
    0xa1100ull, 
    0x142200ull, 
    0x284400ull, 
    0x508800ull, 
    0xa01000ull, 
    0x402000ull, 
    0x2040004ull, 
    0x5080008ull, 
    0xa110011ull, 
    0x14220022ull, 
    0x28440044ull, 
    0x50880088ull, 
    0xa0100010ull, 
    0x40200020ull, 
    0x204000402ull, 
    0x508000805ull, 
    0xa1100110aull, 
    0x1422002214ull, 
    0x2844004428ull, 
    0x5088008850ull, 
    0xa0100010a0ull, 
    0x4020002040ull, 
    0x20400040200ull, 
    0x50800080500ull, 
    0xa1100110a00ull, 
    0x142200221400ull, 
    0x284400442800ull, 
    0x508800885000ull, 
    0xa0100010a000ull, 
    0x402000204000ull, 
    0x2040004020000ull, 
    0x5080008050000ull, 
    0xa1100110a0000ull, 
    0x14220022140000ull, 
    0x28440044280000ull, 
    0x50880088500000ull, 
    0xa0100010a00000ull, 
    0x40200020400000ull, 
    0x204000402000000ull, 
    0x508000805000000ull, 
    0xa1100110a000000ull, 
    0x1422002214000000ull, 
    0x2844004428000000ull, 
    0x5088008850000000ull, 
    0xa0100010a0000000ull, 
    0x4020002040000000ull, 
    0x400040200000000ull, 
    0x800080500000000ull, 
    0x1100110a00000000ull, 
    0x2200221400000000ull, 
    0x4400442800000000ull, 
    0x8800885000000000ull, 
    0x100010a000000000ull, 
    0x2000204000000000ull, 
    0x4020000000000ull, 
    0x8050000000000ull, 
    0x110a0000000000ull, 
    0x22140000000000ull, 
    0x44280000000000ull, 
    0x88500000000000ull, 
    0x10a00000000000ull, 
    0x20400000000000ull,
};
const u64 king_masks[64] = {
    0x302ull, 
    0x705ull, 
    0xe0aull, 
    0x1c14ull, 
    0x3828ull, 
    0x7050ull, 
    0xe0a0ull, 
    0xc040ull, 
    0x30203ull, 
    0x70507ull, 
    0xe0a0eull, 
    0x1c141cull, 
    0x382838ull, 
    0x705070ull, 
    0xe0a0e0ull, 
    0xc040c0ull, 
    0x3020300ull, 
    0x7050700ull, 
    0xe0a0e00ull, 
    0x1c141c00ull, 
    0x38283800ull, 
    0x70507000ull, 
    0xe0a0e000ull, 
    0xc040c000ull, 
    0x302030000ull, 
    0x705070000ull, 
    0xe0a0e0000ull, 
    0x1c141c0000ull, 
    0x3828380000ull, 
    0x7050700000ull, 
    0xe0a0e00000ull, 
    0xc040c00000ull, 
    0x30203000000ull, 
    0x70507000000ull, 
    0xe0a0e000000ull, 
    0x1c141c000000ull, 
    0x382838000000ull, 
    0x705070000000ull, 
    0xe0a0e0000000ull, 
    0xc040c0000000ull, 
    0x3020300000000ull, 
    0x7050700000000ull, 
    0xe0a0e00000000ull, 
    0x1c141c00000000ull, 
    0x38283800000000ull, 
    0x70507000000000ull, 
    0xe0a0e000000000ull, 
    0xc040c000000000ull, 
    0x302030000000000ull, 
    0x705070000000000ull, 
    0xe0a0e0000000000ull, 
    0x1c141c0000000000ull, 
    0x3828380000000000ull, 
    0x7050700000000000ull, 
    0xe0a0e00000000000ull, 
    0xc040c00000000000ull, 
    0x203000000000000ull, 
    0x507000000000000ull, 
    0xa0e000000000000ull, 
    0x141c000000000000ull, 
    0x2838000000000000ull, 
    0x5070000000000000ull, 
    0xa0e0000000000000ull, 
    0x40c0000000000000ull,
};
const u64 white_pawn_captures[64] = {
    0, 0, 0, 0, 0, 0, 0, 0,
    0x20000ull, 
    0x50000ull, 
    0xa0000ull, 
    0x140000ull, 
    0x280000ull, 
    0x500000ull, 
    0xa00000ull, 
    0x400000ull, 
    0x2000000ull, 
    0x5000000ull, 
    0xa000000ull, 
    0x14000000ull, 
    0x28000000ull, 
    0x50000000ull, 
    0xa0000000ull, 
    0x40000000ull, 
    0x200000000ull, 
    0x500000000ull, 
    0xa00000000ull, 
    0x1400000000ull, 
    0x2800000000ull, 
    0x5000000000ull, 
    0xa000000000ull, 
    0x4000000000ull, 
    0x20000000000ull, 
    0x50000000000ull, 
    0xa0000000000ull, 
    0x140000000000ull, 
    0x280000000000ull, 
    0x500000000000ull, 
    0xa00000000000ull, 
    0x400000000000ull, 
    0x2000000000000ull, 
    0x5000000000000ull, 
    0xa000000000000ull, 
    0x14000000000000ull, 
    0x28000000000000ull, 
    0x50000000000000ull, 
    0xa0000000000000ull, 
    0x40000000000000ull, 
    0x200000000000000ull, 
    0x500000000000000ull, 
    0xa00000000000000ull, 
    0x1400000000000000ull, 
    0x2800000000000000ull, 
    0x5000000000000000ull, 
    0xa000000000000000ull, 
    0x4000000000000000ull,
    0, 0, 0, 0, 0, 0, 0, 0
};
const u64 black_pawn_captures[64] = {
    0, 0, 0, 0, 0, 0, 0, 0,
    0x2ull, 
    0x5ull, 
    0xaull, 
    0x14ull, 
    0x28ull, 
    0x50ull, 
    0xa0ull, 
    0x40ull, 
    0x200ull, 
    0x500ull, 
    0xa00ull, 
    0x1400ull, 
    0x2800ull, 
    0x5000ull, 
    0xa000ull, 
    0x4000ull, 
    0x20000ull, 
    0x50000ull, 
    0xa0000ull, 
    0x140000ull, 
    0x280000ull, 
    0x500000ull, 
    0xa00000ull, 
    0x400000ull, 
    0x2000000ull, 
    0x5000000ull, 
    0xa000000ull, 
    0x14000000ull, 
    0x28000000ull, 
    0x50000000ull, 
    0xa0000000ull, 
    0x40000000ull, 
    0x200000000ull, 
    0x500000000ull, 
    0xa00000000ull, 
    0x1400000000ull, 
    0x2800000000ull, 
    0x5000000000ull, 
    0xa000000000ull, 
    0x4000000000ull, 
    0x20000000000ull, 
    0x50000000000ull, 
    0xa0000000000ull, 
    0x140000000000ull, 
    0x280000000000ull, 
    0x500000000000ull, 
    0xa00000000000ull, 
    0x400000000000ull,
    0, 0, 0, 0, 0, 0, 0, 0
};

u64 rook_magics[64];
u64 bishop_magics[64];
u64 rook_moves[64][1 << 12];
u64 bishop_moves[64][1 << 9];

const move null_move = {-1, -1, X, false, false};